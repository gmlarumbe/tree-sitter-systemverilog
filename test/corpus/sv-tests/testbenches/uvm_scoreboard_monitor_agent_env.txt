============================================
sv-tests/testbenches/uvm_scoreboard_monitor_agent_env
============================================

// Copyright (C) 2019-2021  The SymbiFlow Authors.
//
// Use of this source code is governed by a ISC-style
// license that can be found in the LICENSE file or at
// https://opensource.org/licenses/ISC
//
// SPDX-License-Identifier: ISC


/*
:name: uvm_scoreboard_monitor_agent_env
:description: uvm scoreboard + monitor + agent + env test
:tags: uvm uvm-scoreboards
:type: simulation elaboration parsing
:timeout: 30
:unsynthesizable: 1
*/

import uvm_pkg::*;
`include "uvm_macros.svh"

`define PATTERN 2

interface input_if(input clk);
    logic [7:0] data;
    modport port(input clk, data);
endinterface

interface output_if(input clk);
    logic [7:0] data;
    modport port(input clk, output data);
endinterface

module dut(input_if.port in, output_if.port out);
    always @(posedge in.clk)
        out.data <= in.data;
endmodule

class packet_out extends uvm_sequence_item;
    logic [7:0] data;

    `uvm_object_utils_begin(packet_out)
        `uvm_field_int(data, UVM_ALL_ON|UVM_HEX)
    `uvm_object_utils_end

    function new(string name="packet_out");
        super.new(name);
    endfunction: new
endclass

class monitor extends uvm_monitor;
    `uvm_component_utils(monitor)
    virtual output_if  vif;
    packet_out packet;

    uvm_analysis_port #(packet_out) item_collected_port;

    function new(string name, uvm_component parent);
        super.new(name, parent);
        item_collected_port = new ("item_collected_port", this);
    endfunction

    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        packet = packet_out::type_id::create("packet", this);
    endfunction

    virtual function void connect_phase(uvm_phase phase);
        super.connect_phase(phase);
        assert(uvm_resource_db#(virtual output_if)::read_by_name(
          "env", "output_if", vif));
    endfunction

    virtual task run_phase(uvm_phase phase);
        super.run_phase(phase);
        fork
            collect_transactions(phase);
        join
    endtask

    virtual task collect_transactions(uvm_phase phase);
        forever begin
            repeat(2) @(posedge vif.clk);
            packet.data = vif.data;
            item_collected_port.write(packet);
        end
    endtask
endclass

class agent_passive extends uvm_agent;
    monitor mon;

    uvm_analysis_port #(packet_out) item_collected_port;
    `uvm_component_utils(agent_passive)

    function new(string name = "agent_passive", uvm_component parent = null);
        super.new(name, parent);
        item_collected_port = new("item_collected_port", this);
    endfunction

    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        mon = monitor::type_id::create("mon_out", this);
    endfunction

    virtual function void connect_phase(uvm_phase phase);
        super.connect_phase(phase);
        mon.item_collected_port.connect(item_collected_port);
    endfunction
endclass

class comparator #(type T = packet_out) extends uvm_scoreboard;
    typedef comparator #(T) this_type;
    `uvm_component_param_utils(this_type)
    int match, mismatch;

    const static string type_name = "comparator #(T)";

    uvm_analysis_imp #(T, this_type) from_dut;

    typedef uvm_built_in_converter #( T ) convert;

    event end_of_simulation;

    function new(string name, uvm_component parent);
        super.new(name, parent);
        from_dut = new("from_dut", this);
        match = 0;
        mismatch = 0;
    endfunction

    virtual function string get_type_name();
        return type_name;
    endfunction

    task run_phase(uvm_phase phase);
        phase.raise_objection(this);
        @(end_of_simulation);
        phase.drop_objection(this);
    endtask

    virtual function void write(T rec);
        if(rec.data == `PATTERN) begin
          `uvm_info("RESULT", $sformatf("Comparator match %d == %d", rec.data, `PATTERN), UVM_LOW);
          match++;
        end
        else begin
          `uvm_error("RESULT", $sformatf("Comparator mismatch %d != %d", rec.data, `PATTERN));
          mismatch++;
        end
        -> end_of_simulation;
  endfunction
endclass

class env extends uvm_env;
    agent_passive   agent;
    comparator #(packet_out) comp;  
    virtual input_if vif;

    `uvm_component_utils(env)

    function new(string name, uvm_component parent = null);
        super.new(name, parent);
    endfunction

    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        agent = agent_passive::type_id::create("agent", this);
        comp = comparator#(packet_out)::type_id::create("comp", this);
    endfunction

    virtual function void connect_phase(uvm_phase phase);
        super.connect_phase(phase);
        assert(uvm_resource_db#(virtual input_if)::read_by_name(
          get_full_name(), "input_if", vif));
        agent.item_collected_port.connect(comp.from_dut);
    endfunction

    virtual function void end_of_elaboration_phase(uvm_phase phase);
        super.end_of_elaboration_phase(phase);
    endfunction

    task run_phase(uvm_phase phase);
        `uvm_info("RESULT", $sformatf("Writing %0d to input interface", `PATTERN), UVM_LOW);
        vif.data <= `PATTERN;
    endtask

    virtual function void report_phase(uvm_phase phase);
        super.report_phase(phase);
    endfunction
endclass

module top;
    logic clk;
    env environment;

    input_if in(clk);
    output_if out(clk);
    dut d(in, out);

    always #5 clk = !clk;

    initial begin
        environment = new("env");
        uvm_resource_db#(virtual input_if)::set("env", "input_if", in);
        uvm_resource_db#(virtual output_if)::set("env",  "output_if", out);
        clk = 0;
        run_test();
    end
endmodule

----

(source_file
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (block_comment)
  (package_import_declaration
    (package_import_item
      (simple_identifier)))
  (include_compiler_directive
    (quoted_string
      (quoted_string_item)))
  (text_macro_definition
    (text_macro_name
      (simple_identifier))
    (macro_text))
  (interface_declaration
    (interface_ansi_header
      name: (simple_identifier)
      (list_of_port_declarations
        (ansi_port_declaration
          (net_port_header
            (port_direction))
          port_name: (simple_identifier))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (modport_declaration
      (modport_item
        (simple_identifier)
        (modport_ports_declaration
          (modport_simple_ports_declaration
            (port_direction)
            (modport_simple_port
              (simple_identifier))
            (modport_simple_port
              (simple_identifier)))))))
  (interface_declaration
    (interface_ansi_header
      name: (simple_identifier)
      (list_of_port_declarations
        (ansi_port_declaration
          (net_port_header
            (port_direction))
          port_name: (simple_identifier))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (modport_declaration
      (modport_item
        (simple_identifier)
        (modport_ports_declaration
          (modport_simple_ports_declaration
            (port_direction)
            (modport_simple_port
              (simple_identifier))))
        (modport_ports_declaration
          (modport_simple_ports_declaration
            (port_direction)
            (modport_simple_port
              (simple_identifier)))))))
  (module_declaration
    (module_ansi_header
      (module_keyword)
      name: (simple_identifier)
      (list_of_port_declarations
        (ansi_port_declaration
          (interface_port_header
            interface_name: (simple_identifier)
            modport_name: (simple_identifier))
          port_name: (simple_identifier))
        (ansi_port_declaration
          (interface_port_header
            interface_name: (simple_identifier)
            modport_name: (simple_identifier))
          port_name: (simple_identifier))))
    (always_construct
      (always_keyword)
      (statement
        (statement_item
          (procedural_timing_control_statement
            (event_control
              (clocking_event
                (event_expression
                  (edge_identifier)
                  (expression
                    (primary
                      (hierarchical_identifier
                        (simple_identifier)
                        (simple_identifier)))))))
            (statement_or_null
              (statement
                (statement_item
                  (nonblocking_assignment
                    (variable_lvalue
                      (hierarchical_identifier
                        (simple_identifier)
                        (simple_identifier)))
                    (expression
                      (primary
                        (hierarchical_identifier
                          (simple_identifier)
                          (simple_identifier)))))))))))))
  (class_declaration
    name: (simple_identifier)
    (class_type
      (simple_identifier))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (integer_vector_type)
              (packed_dimension
                (constant_range
                  (constant_expression
                    (constant_primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number))))))
                  (constant_expression
                    (constant_primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number))))))))))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier))))))))))
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  left: (expression
                    (primary
                      (hierarchical_identifier
                        (simple_identifier))))
                  right: (expression
                    (primary
                      (hierarchical_identifier
                        (simple_identifier)))))))))))
    (class_item
      (text_macro_usage
        (simple_identifier)))
    (class_item
      (class_method
        (class_constructor_declaration
          (class_constructor_arg_list
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type))
                name: (simple_identifier)
                (expression
                  (primary
                    (primary_literal
                      (string_literal
                        (quoted_string
                          (quoted_string_item)))))))))
          (list_of_arguments
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))))))
  (class_declaration
    name: (simple_identifier)
    (class_type
      (simple_identifier))
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier))))))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (class_type
                (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (ordered_parameter_assignment
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))))))))))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_method
        (class_constructor_declaration
          (class_constructor_arg_list
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type))
                name: (simple_identifier)))
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier))))
          (list_of_arguments
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (hierarchical_identifier
                      (simple_identifier))
                    (class_new
                      (list_of_arguments
                        (expression
                          (primary
                            (primary_literal
                              (string_literal
                                (quoted_string
                                  (quoted_string_item))))))
                        (expression
                          (primary))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (function_subroutine_call
                              (subroutine_call
                                (method_call
                                  (primary
                                    (function_subroutine_call
                                      (subroutine_call
                                        (method_call
                                          (primary
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (method_call_body
                                            name: (simple_identifier))))))
                                  (method_call_body
                                    name: (simple_identifier)
                                    arguments: (list_of_arguments
                                      (expression
                                        (primary
                                          (primary_literal
                                            (string_literal
                                              (quoted_string
                                                (quoted_string_item))))))
                                      (expression
                                        (primary)))))))))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (simple_immediate_assert_statement
                      (expression
                        (primary
                          (function_subroutine_call
                            (subroutine_call
                              (method_call
                                (class_type
                                  (simple_identifier)
                                  (parameter_value_assignment
                                    (list_of_parameter_value_assignments
                                      (ordered_parameter_assignment
                                        (param_expression
                                          (data_type
                                            (simple_identifier)))))))
                                (method_call_body
                                  name: (simple_identifier)
                                  arguments: (list_of_arguments
                                    (expression
                                      (primary
                                        (primary_literal
                                          (string_literal
                                            (quoted_string
                                              (quoted_string_item))))))
                                    (expression
                                      (primary
                                        (primary_literal
                                          (string_literal
                                            (quoted_string
                                              (quoted_string_item))))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)))))))))))
                      (action_block
                        (statement_or_null)))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (task_declaration
          (task_body_declaration
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (statement_or_null
              (statement
                (statement_item
                  (subroutine_call_statement
                    (subroutine_call
                      (method_call
                        (implicit_class_handle)
                        (method_call_body
                          name: (simple_identifier)
                          arguments: (list_of_arguments
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))
            (statement_or_null
              (statement
                (statement_item
                  (par_block
                    (statement_or_null
                      (statement
                        (statement_item
                          (subroutine_call_statement
                            (subroutine_call
                              (tf_call
                                (hierarchical_identifier
                                  (simple_identifier))
                                (list_of_arguments
                                  (expression
                                    (primary
                                      (hierarchical_identifier
                                        (simple_identifier)))))))))))
                    (join_keyword)))))))))
    (class_item
      (class_method
        (method_qualifier)
        (task_declaration
          (task_body_declaration
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (statement_or_null
              (statement
                (statement_item
                  (loop_statement
                    (statement_or_null
                      (statement
                        (statement_item
                          (seq_block
                            (statement_or_null
                              (statement
                                (statement_item
                                  (loop_statement
                                    (expression
                                      (primary
                                        (primary_literal
                                          (integral_number
                                            (decimal_number
                                              (unsigned_number))))))
                                    (statement_or_null
                                      (statement
                                        (statement_item
                                          (procedural_timing_control_statement
                                            (event_control
                                              (clocking_event
                                                (event_expression
                                                  (edge_identifier)
                                                  (expression
                                                    (primary
                                                      (hierarchical_identifier
                                                        (simple_identifier)
                                                        (simple_identifier)))))))
                                            (statement_or_null)))))))))
                            (statement_or_null
                              (statement
                                (statement_item
                                  (blocking_assignment
                                    (operator_assignment
                                      (variable_lvalue
                                        (hierarchical_identifier
                                          (simple_identifier)
                                          (simple_identifier)))
                                      (assignment_operator)
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier)
                                            (simple_identifier)))))))))
                            (statement_or_null
                              (statement
                                (statement_item
                                  (subroutine_call_statement
                                    (subroutine_call
                                      (tf_call
                                        (hierarchical_identifier
                                          (simple_identifier)
                                          (simple_identifier))
                                        (list_of_arguments
                                          (expression
                                            (primary
                                              (hierarchical_identifier
                                                (simple_identifier))))))))))))))))))))))))
  (class_declaration
    name: (simple_identifier)
    (class_type
      (simple_identifier))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (class_type
                (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (ordered_parameter_assignment
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))))))))))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier))))))))))
    (class_item
      (class_method
        (class_constructor_declaration
          (class_constructor_arg_list
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type))
                name: (simple_identifier)
                (expression
                  (primary
                    (primary_literal
                      (string_literal
                        (quoted_string
                          (quoted_string_item))))))))
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)
                (expression
                  (primary)))))
          (list_of_arguments
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (hierarchical_identifier
                      (simple_identifier))
                    (class_new
                      (list_of_arguments
                        (expression
                          (primary
                            (primary_literal
                              (string_literal
                                (quoted_string
                                  (quoted_string_item))))))
                        (expression
                          (primary))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (function_subroutine_call
                              (subroutine_call
                                (method_call
                                  (primary
                                    (function_subroutine_call
                                      (subroutine_call
                                        (method_call
                                          (primary
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (method_call_body
                                            name: (simple_identifier))))))
                                  (method_call_body
                                    name: (simple_identifier)
                                    arguments: (list_of_arguments
                                      (expression
                                        (primary
                                          (primary_literal
                                            (string_literal
                                              (quoted_string
                                                (quoted_string_item))))))
                                      (expression
                                        (primary)))))))))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (tf_call
                          (hierarchical_identifier
                            (simple_identifier)
                            (simple_identifier)
                            (simple_identifier))
                          (list_of_arguments
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)))))))))))))))))
  (class_declaration
    name: (simple_identifier)
    (parameter_port_list
      (parameter_port_declaration
        (type_parameter_declaration
          (list_of_type_assignments
            (type_assignment
              name: (simple_identifier)
              value: (simple_identifier))))))
    (class_type
      (simple_identifier))
    (class_item
      (class_property
        (data_declaration
          (type_declaration
            (class_type
              (simple_identifier)
              (parameter_value_assignment
                (list_of_parameter_value_assignments
                  (ordered_parameter_assignment
                    (param_expression
                      (mintypmax_expression
                        (expression
                          (primary
                            (hierarchical_identifier
                              (simple_identifier))))))))))
            type_name: (simple_identifier)))))
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier))))))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (integer_atom_type)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (class_item_qualifier)
        (data_type)
        (simple_identifier)
        (constant_expression
          (constant_primary
            (primary_literal
              (string_literal
                (quoted_string
                  (quoted_string_item))))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (class_type
                (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (ordered_parameter_assignment
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))
                    (ordered_parameter_assignment
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))))))))))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (data_declaration
          (type_declaration
            (class_type
              (simple_identifier)
              (parameter_value_assignment
                (list_of_parameter_value_assignments
                  (ordered_parameter_assignment
                    (param_expression
                      (mintypmax_expression
                        (expression
                          (primary
                            (hierarchical_identifier
                              (simple_identifier))))))))))
            type_name: (simple_identifier)))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_method
        (class_constructor_declaration
          (class_constructor_arg_list
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type))
                name: (simple_identifier)))
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier))))
          (list_of_arguments
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (hierarchical_identifier
                      (simple_identifier))
                    (class_new
                      (list_of_arguments
                        (expression
                          (primary
                            (primary_literal
                              (string_literal
                                (quoted_string
                                  (quoted_string_item))))))
                        (expression
                          (primary)))))))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (operator_assignment
                      (variable_lvalue
                        (hierarchical_identifier
                          (simple_identifier)))
                      (assignment_operator)
                      (expression
                        (primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (operator_assignment
                      (variable_lvalue
                        (hierarchical_identifier
                          (simple_identifier)))
                      (assignment_operator)
                      (expression
                        (primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number)))))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void
              (data_type))
            name: (simple_identifier)
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (jump_statement
                      (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)))))))))))))
    (class_item
      (class_method
        (task_declaration
          (task_body_declaration
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (statement_or_null
              (statement
                (statement_item
                  (subroutine_call_statement
                    (subroutine_call
                      (tf_call
                        (hierarchical_identifier
                          (simple_identifier)
                          (simple_identifier))
                        (list_of_arguments
                          (expression
                            (primary)))))))))
            (statement_or_null
              (statement
                (statement_item
                  (procedural_timing_control_statement
                    (event_control
                      (clocking_event
                        (event_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))
                    (statement_or_null)))))
            (statement_or_null
              (statement
                (statement_item
                  (subroutine_call_statement
                    (subroutine_call
                      (tf_call
                        (hierarchical_identifier
                          (simple_identifier)
                          (simple_identifier))
                        (list_of_arguments
                          (expression
                            (primary)))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (conditional_statement
                      (cond_predicate
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)
                                (simple_identifier))))
                          right: (expression
                            (text_macro_usage
                              (simple_identifier)))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (text_macro_usage
                                      (simple_identifier)
                                      (list_of_actual_arguments
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (primary_literal
                                                    (string_literal
                                                      (quoted_string
                                                        (quoted_string_item)))))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (function_subroutine_call
                                                    (subroutine_call
                                                      (system_tf_call
                                                        (system_tf_identifier)
                                                        (list_of_arguments
                                                          (expression
                                                            (primary
                                                              (primary_literal
                                                                (string_literal
                                                                  (quoted_string
                                                                    (quoted_string_item))))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier)
                                                                (simple_identifier))))
                                                          (expression
                                                            (text_macro_usage
                                                              (simple_identifier))))))))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier))))))))))))
                              (statement_or_null)
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (blocking_assignment
                                      (inc_or_dec_expression
                                        (variable_lvalue
                                          (hierarchical_identifier
                                            (simple_identifier)))
                                        (inc_or_dec_operator))))))))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (text_macro_usage
                                      (simple_identifier)
                                      (list_of_actual_arguments
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (primary_literal
                                                    (string_literal
                                                      (quoted_string
                                                        (quoted_string_item)))))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (function_subroutine_call
                                                    (subroutine_call
                                                      (system_tf_call
                                                        (system_tf_identifier)
                                                        (list_of_arguments
                                                          (expression
                                                            (primary
                                                              (primary_literal
                                                                (string_literal
                                                                  (quoted_string
                                                                    (quoted_string_item))))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier)
                                                                (simple_identifier))))
                                                          (expression
                                                            (text_macro_usage
                                                              (simple_identifier)))))))))))))))))
                              (statement_or_null)
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (blocking_assignment
                                      (inc_or_dec_expression
                                        (variable_lvalue
                                          (hierarchical_identifier
                                            (simple_identifier)))
                                        (inc_or_dec_operator)))))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (event_trigger
                      (hierarchical_identifier
                        (simple_identifier))))))))))))
  (class_declaration
    name: (simple_identifier)
    (class_type
      (simple_identifier))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (class_type
                (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (ordered_parameter_assignment
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))))))))))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier))))))))))
    (class_item
      (class_method
        (class_constructor_declaration
          (class_constructor_arg_list
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type))
                name: (simple_identifier)))
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)
                (expression
                  (primary)))))
          (list_of_arguments
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (function_subroutine_call
                              (subroutine_call
                                (method_call
                                  (primary
                                    (function_subroutine_call
                                      (subroutine_call
                                        (method_call
                                          (primary
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (method_call_body
                                            name: (simple_identifier))))))
                                  (method_call_body
                                    name: (simple_identifier)
                                    arguments: (list_of_arguments
                                      (expression
                                        (primary
                                          (primary_literal
                                            (string_literal
                                              (quoted_string
                                                (quoted_string_item))))))
                                      (expression
                                        (primary)))))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (function_subroutine_call
                              (subroutine_call
                                (method_call
                                  (primary
                                    (function_subroutine_call
                                      (subroutine_call
                                        (method_call
                                          (class_type
                                            (simple_identifier)
                                            (parameter_value_assignment
                                              (list_of_parameter_value_assignments
                                                (ordered_parameter_assignment
                                                  (param_expression
                                                    (mintypmax_expression
                                                      (expression
                                                        (primary
                                                          (hierarchical_identifier
                                                            (simple_identifier))))))))))
                                          (method_call_body
                                            name: (simple_identifier))))))
                                  (method_call_body
                                    name: (simple_identifier)
                                    arguments: (list_of_arguments
                                      (expression
                                        (primary
                                          (primary_literal
                                            (string_literal
                                              (quoted_string
                                                (quoted_string_item))))))
                                      (expression
                                        (primary)))))))))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (simple_immediate_assert_statement
                      (expression
                        (primary
                          (function_subroutine_call
                            (subroutine_call
                              (method_call
                                (class_type
                                  (simple_identifier)
                                  (parameter_value_assignment
                                    (list_of_parameter_value_assignments
                                      (ordered_parameter_assignment
                                        (param_expression
                                          (data_type
                                            (simple_identifier)))))))
                                (method_call_body
                                  name: (simple_identifier)
                                  arguments: (list_of_arguments
                                    (expression
                                      (primary
                                        (function_subroutine_call
                                          (subroutine_call
                                            (tf_call
                                              (hierarchical_identifier
                                                (simple_identifier)))))))
                                    (expression
                                      (primary
                                        (primary_literal
                                          (string_literal
                                            (quoted_string
                                              (quoted_string_item))))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)))))))))))
                      (action_block
                        (statement_or_null)))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (tf_call
                          (hierarchical_identifier
                            (simple_identifier)
                            (simple_identifier)
                            (simple_identifier))
                          (list_of_arguments
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)
                                  (simple_identifier))))))))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))))))))))
    (class_item
      (class_method
        (task_declaration
          (task_body_declaration
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (statement_or_null
              (statement
                (statement_item
                  (text_macro_usage
                    (simple_identifier)
                    (list_of_actual_arguments
                      (actual_argument
                        (param_expression
                          (mintypmax_expression
                            (expression
                              (primary
                                (primary_literal
                                  (string_literal
                                    (quoted_string
                                      (quoted_string_item)))))))))
                      (actual_argument
                        (param_expression
                          (mintypmax_expression
                            (expression
                              (primary
                                (function_subroutine_call
                                  (subroutine_call
                                    (system_tf_call
                                      (system_tf_identifier)
                                      (list_of_arguments
                                        (expression
                                          (primary
                                            (primary_literal
                                              (string_literal
                                                (quoted_string
                                                  (quoted_string_item))))))
                                        (expression
                                          (text_macro_usage
                                            (simple_identifier))))))))))))
                      (actual_argument
                        (param_expression
                          (mintypmax_expression
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))
            (statement_or_null)
            (statement_or_null
              (statement
                (statement_item
                  (nonblocking_assignment
                    (variable_lvalue
                      (hierarchical_identifier
                        (simple_identifier)
                        (simple_identifier)))
                    (expression
                      (text_macro_usage
                        (simple_identifier)))))))))))
    (class_item
      (class_method
        (method_qualifier)
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (simple_identifier)))
                name: (simple_identifier)))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (implicit_class_handle)
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier))))))))))))))))))
  (module_declaration
    (module_ansi_header
      (module_keyword)
      name: (simple_identifier))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (net_declaration
      (simple_identifier)
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))))
    (module_instantiation
      instance_type: (simple_identifier)
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (ordered_port_connection
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))
    (module_instantiation
      instance_type: (simple_identifier)
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (ordered_port_connection
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))
    (module_instantiation
      instance_type: (simple_identifier)
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (ordered_port_connection
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (ordered_port_connection
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))
    (always_construct
      (always_keyword)
      (statement
        (statement_item
          (procedural_timing_control_statement
            (delay_control
              (delay_value
                (unsigned_number)))
            (statement_or_null
              (statement
                (statement_item
                  (blocking_assignment
                    (operator_assignment
                      (variable_lvalue
                        (hierarchical_identifier
                          (simple_identifier)))
                      (assignment_operator)
                      (expression
                        operator: (unary_operator)
                        argument: (primary
                          (hierarchical_identifier
                            (simple_identifier)))))))))))))
    (initial_construct
      (statement_or_null
        (statement
          (statement_item
            (seq_block
              (statement_or_null
                (statement
                  (statement_item
                    (blocking_assignment
                      (hierarchical_identifier
                        (simple_identifier))
                      (class_new
                        (list_of_arguments
                          (expression
                            (primary
                              (primary_literal
                                (string_literal
                                  (quoted_string
                                    (quoted_string_item))))))))))))
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (class_type
                            (simple_identifier)
                            (parameter_value_assignment
                              (list_of_parameter_value_assignments
                                (ordered_parameter_assignment
                                  (param_expression
                                    (data_type
                                      (simple_identifier)))))))
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item))))))
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item))))))
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier))))))))))))
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (method_call
                          (class_type
                            (simple_identifier)
                            (parameter_value_assignment
                              (list_of_parameter_value_assignments
                                (ordered_parameter_assignment
                                  (param_expression
                                    (data_type
                                      (simple_identifier)))))))
                          (method_call_body
                            name: (simple_identifier)
                            arguments: (list_of_arguments
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item))))))
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item))))))
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier))))))))))))
              (statement_or_null
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))))))
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (tf_call
                          (hierarchical_identifier
                            (simple_identifier)))))))))))))))
